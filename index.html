<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Bilhete Único</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="@import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f3f4f6;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #92008C;
            box-shadow: 0 0 0 3px rgba(146, 0, 140, 0.3);
            transition: all 0.2s ease-in-out;
        }

        #submitButton:disabled {
            background-color: #F8F8F8;
            border: none;
            color: #9CA3AF;
            font-weight: bold;
            cursor: not-allowed;
            opacity: 0.8;
            box-shadow: none;
        }

        #submitButton:not(:disabled) {
            background-color: #92008C;
            color: white;
            font-weight: bold;
            border: solid 2px #92008C;
            transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out;
        }

        #submitButton:not(:disabled):hover {
            background-color: #7a0075;
            border-color: #7a0075;
        }

        input[type="checkbox"] {
            accent-color: #92008C;
        }

        #helpBilheteBtn:hover svg, #helpBilheteBtn:focus svg {
            color: #92008C;
        }
        #helpBilheteBtn:hover, #helpBilheteBtn:focus {
             color: #92008C;
        }

        .custom-alert-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .custom-alert-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
            max-width: 28rem;
            width: 90%;
            text-align: center;
            position: relative;
        }

        .custom-alert-close-btn {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #9CA3AF;
            cursor: pointer;
            line-height: 1;
        }
        .custom-alert-close-btn:hover {
            color: #6B7280;
        }

        .input-error {
            border-color: #EF4444;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.3);
        }

        .error-message {
            color: #EF4444;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }
        
        .countdown-box {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 16px;
            /*border: 0.5px solid #6a00653a;*/
            /*background: linear-gradient(135deg, #92008C 0%, #6a0065 100%);*/
            color:linear-gradient(to right,#E87E55, #92008C,#ff206a);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 1.5rem;
           /* box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);*/
        }
        
        .countdown-timer {
            font-family: 'Poppins', sans-serif;
            font-size: 2rem;
            font-weight: 900;
            width: 18.125rem;
            letter-spacing: 2.5px;
            text-align: center;
            margin: 0.5rem 0 ;
            /*background-color: #6a0065;*/
        }
        
        .countdown-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            width: 18.125rem;
            font-size: 0.75rem;
            opacity: 0.9;
            padding: 0 0px 0 0px;
            text-align: center;
           /* background-color: #9CA3AF;*/
        }
        
        .countdown-label {
            display: flex;
           /*background-color: #6a0065;*/
            justify-content: space-around;
            text-align: center;
            padding: 0 5px;
            margin: 0 0 0 22px;
        }

        /*.countdown-label {
            flex: 1;
            text-align: center;
            padding: 0 5px;
            margin: 0 10px 0 10px;
        }*/
        
        .admin-panel {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
        }
        
        .admin-config-box {
            background-color: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .triangle-icon {
            display: inline-block;
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 17.3px solid #EF4444;
            position: relative;
            margin-right: 10px;
        }
        
        .triangle-icon::after {
            content: "!";
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        
        .unavailable-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            text-align: center;
        }
        
        .time-input-group {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .time-input {
            text-align: center;
        }
        
        .time-input-label {
            display: block;
            text-align: center;
            font-size: 0.75rem;
            margin-top: 0.25rem;
            color: #6b7280;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <!-- Contêiner principal do formulário, centralizado e com sombra -->
    <div id="formContainer" class="bg-white p-8 rounded-xl shadow-lg w-full max-w-2xl">
        <!-- Espaço para a imagem responsiva com padding ajustado -->
        <div class="pt-10 mb-10 text-center">
            <img src="CEDESP.png" alt="Logo da Instituição" class="mx-auto w-auto h-auto max-h-16 rounded-lg">
        </div>

        <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">Cadastro de Bilhete Único</h1>
        
        <!-- Contador regressivo -->
        <div id="countdownContainer" class="countdown-box hidden">
            <p class="text-center font-medium mb-2">A planilha ficará disponível por:</p>
            <div id="countdownTimer" class="countdown-timer">00 : 00 : 00 : 00</div>
            <div class="countdown-labels">
                <span class="countdown-label">dias</span>
                <span class="countdown-label">horas</span>
                <span class="countdown-label">minutos</span>
                <span class="countdown-label">segundos</span>
            </div>
        </div>

        <form id="registrationForm" class="space-y-6">
            <!-- Campos do formulário (mantidos do código original) -->
            <div>
                <label for="nomeCompleto" class="block text-gray-700 text-sm font-medium mb-2">Nome Completo:</label>
                <input type="text" id="nomeCompleto" name="nomeCompleto" required
                       class="w-full p-3 border border-gray-300 rounded-lg"
                       aria-label="Nome completo do aluno">
                <div id="nomeCompletoError" class="error-message hidden">Por favor, informe seu nome completo (mínimo 2 palavras)</div>
            </div>

            <div>
                <label for="cpf" class="block text-gray-700 text-sm font-medium mb-2">CPF:</label>
                <input type="text" id="cpf" name="cpf" required
                       placeholder="000.000.000-00"
                       class="w-full p-3 border border-gray-300 rounded-lg"
                       aria-label="Número de CPF no formato 000.000.000-00">
                <div id="cpfError" class="error-message hidden">CPF inválido. Verifique o número digitado.</div>
            </div>

            <div>
                <div class="flex items-center justify-between mb-2">
                    <label for="numeroBilhete" class="block text-gray-700 text-sm font-medium">Número do Bilhete:</label>
                    <button type="button" id="helpBilheteBtn" class="text-blue-500 hover:text-blue-700 text-sm font-medium focus:outline-none flex items-center group" aria-label="Ajuda sobre o número do bilhete">
                        <svg class="w-5 h-5 mr-1 text-blue-500 group-hover:text-blue-700 transition duration-150 ease-in-out" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9.247a.75.75 0 01.968-.081l2.365 1.774c.231.173.355.452.355.733s-.124.56-.355.733l-2.365 1.774a.75.75 0 01-1.049-.247 6.002 6.002 0 010-8.878zM12 21a9 9 0 110-18 9 9 0 010 18z"></path>
                        </svg>
                        Onde encontrar?
                    </button>
                </div>
                <input type="text" id="numeroBilhete" name="numeroBilhete" required
                       class="w-full p-3 border border-gray-300 rounded-lg"
                       aria-label="Número do bilhete">
                <div id="bilheteError" class="error-message hidden">Número do bilhete deve conter 11 dígitos</div>
            </div>

            <div>
                <label for="curso" class="block text-gray-700 text-sm font-medium mb-2">Curso:</label>
                <select id="curso" name="curso" required
                        class="w-full p-3 border border-gray-300 rounded-lg bg-white"
                        aria-label="Selecione o curso desejado">
                    <option value="" disabled selected>Selecione um curso</option>
                    <option value="Auxiliar Administrativo">Auxiliar Administrativo</option>
                    <option value="Criação de Páginas Web">Criação de Páginas Web</option>
                    <option value="Comandos Lógicos Programáveis">Comandos Lógicos Programáveis</option>
                    <option value="Eletricista Instalador">Eletricista Instalador</option>
                    <option value="Instalador de Acessórios Automotivo">Instalador de Acessórios Automotivo</option>
                    <option value="Mecânica de Motor Ciclo Otto">Mecânica de Motor Ciclo Otto</option>
                    <option value="Mecânica de Suspensão, Direção E Freios de Veículos Leves">Mecânica de Suspensão, Direção E Freios de Veículos Leves</option>
                    <option value="Operador de Microcomputador">Operador de Microcomputador</option>
                    <option value="Programador Back-End">Programador Back-End</option>
                </select>
            </div>

            <div>
                <label for="turmaProfissionalizante" class="block text-gray-700 text-sm font-medium mb-2">Turma do Curso Profissionalizante:</label>
                <select id="turmaProfissionalizante" name="turmaProfissionalizante" required
                        class="w-full p-3 border border-gray-300 rounded-lg bg-white"
                        aria-label="Selecione a turma do curso profissionalizante">
                    <option value="" disabled selected>Selecione a turma</option>
                    <option value="1">Turma 1</option>
                    <option value="2">Turma 2</option>
                    <option value="3">Turma 3</option>
                    <option value="4">Turma 4</option>
                </select>
            </div>

            <div>
                <label for="turmaFormacaoHumana" class="block text-gray-700 text-sm font-medium mb-2">Turma Formação Humana:</label>
                <select id="turmaFormacaoHumana" name="turmaFormacaoHumana" required
                        class="w-full p-3 border border-gray-300 rounded-lg bg-white"
                        aria-label="Selecione a turma de formação humana">
                    <option value="A">Turma A</option>
                    <option value="B">Turma B</option>
                    <option value="C">Turma C</option>
                    <option value="D">Turma D</option>
                    <option value="E">Turma E</option>
                    <option value="F">Turma F</option>
                    <option value="G">Turma G</option>
                    <option value="H">Turma H</option>
                    <option value="I">Turma I</option>
                    <option value="J">Turma J</option>
                    <option value="K">Turma K</option>
                    <option value="L">Turma L</option>
                    <option value="M">Turma M</option>
                    <option value="N">Turma N</option>
                    <option value="O">Turma O</option>
                    <option value="P">Turma P</option>
                </select>
            </div>

            <div class="flex items-center">
                <input type="checkbox" id="confirmCheckbox"
                       class="h-4 w-4 border-gray-300 rounded focus:ring-blue-500"
                       aria-label="Confirme a veracidade dos dados para habilitar o envio">
                <label for="confirmCheckbox" class="ml-2 block text-sm text-gray-900">Confirmo a veracidade dos dados acima</label>
            </div>

            <div>
                <button type="submit" id="submitButton" disabled
                        class="w-full p-3 rounded-lg font-semibold shadow-md transition duration-200 ease-in-out flex items-center justify-center"
                        aria-label="Botão para enviar o cadastro">
                    <span id="buttonText">Enviar Cadastro</span>
                    <svg id="buttonSpinner" class="hidden w-5 h-5 ml-2 text-white animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
            </div>

            <div id="statusMessage" class="text-center mt-4 text-sm font-medium hidden" role="alert"></div>
        </form>
    </div>

    <!-- Mensagem de Sucesso -->
    <div id="successMessageContainer" class="hidden bg-white p-8 rounded-xl shadow-lg w-full max-w-2xl text-center flex flex-col items-center justify-center min-h-[400px]">
        <img src="CEDESP.png" alt="Logo da Instituição" class="mx-auto w-auto h-auto max-h-16 rounded-lg mb-8">
        <svg class="w-16 h-16 text-[#B800B1] mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
        <h2 class="text-3xl font-bold text-gray-800 mb-4">Cadastro Realizado com Sucesso!</h2>
        <p class="text-lg text-gray-700 mb-8">Parabéns! Seus dados foram registrados com sucesso. Agradecemos a sua colaboração. Você já pode fechar esta página.</p>
        <button id="backToFormSuccess" class="bg-white text-[#92008C] p-3 rounded-lg font-semibold shadow-md border-2 border-[#92008C] hover:bg-[#92008C] hover:text-white transition duration-200 mt-6">Realizar Novo Cadastro</button>
    </div>

    <!-- Mensagem de Erro -->
    <div id="errorMessageContainer" class="hidden bg-white p-8 rounded-xl shadow-lg w-full max-w-2xl text-center flex flex-col items-center justify-center min-h-[400px]">
        <svg class="w-24 h-24 text-red-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
        <h2 class="text-3xl font-bold text-gray-800 mb-4">Ops! Algo deu errado...</h2>
        <p class="text-lg text-gray-700 mb-6">Não foi possível completar seu cadastro no momento. Isso pode ter acontecido por um problema na sua conexão com a internet ou em nosso sistema.</p>
        <p class="text-lg text-gray-700 mb-8">Por favor, verifique sua conexão e tente novamente. Se o problema persistir, entre em contato conosco para que possamos ajudar!</p>
        <button id="backToFormError" class="bg-blue-500 text-white p-3 rounded-lg font-semibold shadow-md hover:bg-blue-600 transition duration-200">Tentar Novamente</button>
    </div>

    <!-- Página de Indisponibilidade (com painel de admin) -->
    <div id="unavailablePage" class="hidden bg-white p-8 rounded-xl shadow-lg w-full max-w-2xl">
        <div class="unavailable-page mb-8">
            <img src="CEDESP.png" alt="Logo da Instituição" class="mx-auto w-auto h-auto max-h-16 rounded-lg mb-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-4">Prazo para Cadastro Encerrado</h2>
            <p class="text-lg text-gray-700 mb-6">O link será habilitado em:</p>
            <div id="unavailableCountdown" class="countdown-timer mb-2">00 : 00 : 00 : 00</div>
            <div class="countdown-labels mb-8">
                <span class="countdown-label">dias</span>
                <span class="countdown-label">horas</span>
                <span class="countdown-label">minutos</span>
                <span class="countdown-label">segundos</span>
            </div>
        </div>
        
        <!-- Painel de Administração (só visível quando ?admin) -->
        <div id="adminPanel" class="admin-panel hidden">
            <h2 class="text-xl font-bold text-gray-800 mb-4 text-center">Painel de Controle</h2>
            
            <!-- Configuração do tempo ativo -->
            <div class="admin-config-box">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">Tempo de Disponibilidade do Formulário</h3>
                <div class="time-input-group">
                    <div>
                        <input type="number" id="activeDays" min="0" placeholder="0" class="time-input w-full p-3 border border-gray-300 rounded-lg">
                        <span class="time-input-label">dias</span>
                    </div>
                    <div>
                        <input type="number" id="activeHours" min="0" max="23" placeholder="0" class="time-input w-full p-3 border border-gray-300 rounded-lg">
                        <span class="time-input-label">horas</span>
                    </div>
                    <div>
                        <input type="number" id="activeMinutes" min="0" max="59" placeholder="0" class="time-input w-full p-3 border border-gray-300 rounded-lg">
                        <span class="time-input-label">minutos</span>
                    </div>
                    <div>
                        <input type="number" id="activeSeconds" min="0" max="59" placeholder="0" class="time-input w-full p-3 border border-gray-300 rounded-lg">
                        <span class="time-input-label">segundos</span>
                    </div>
                </div>
                <button id="enableFormButton" class="w-full bg-[#92008C] text-white p-3 rounded-lg font-semibold shadow-md hover:bg-[#7a0075] transition duration-200">Habilitar Formulário</button>
            </div>
            
            <!-- Configuração do tempo inativo -->
            <div class="admin-config-box">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">Tempo até Próxima Disponibilidade</h3>
                <div class="time-input-group">
                    <div>
                        <input type="number" id="inactiveDays" min="0" placeholder="0" class="time-input w-full p-3 border border-gray-300 rounded-lg">
                        <span class="time-input-label">dias</span>
                    </div>
                    <div>
                        <input type="number" id="inactiveHours" min="0" max="23" placeholder="0" class="time-input w-full p-3 border border-gray-300 rounded-lg">
                        <span class="time-input-label">horas</span>
                    </div>
                    <div>
                        <input type="number" id="inactiveMinutes" min="0" max="59" placeholder="0" class="time-input w-full p-3 border border-gray-300 rounded-lg">
                        <span class="time-input-label">minutos</span>
                    </div>
                    <div>
                        <input type="number" id="inactiveSeconds" min="0" max="59" placeholder="0" class="time-input w-full p-3 border border-gray-300 rounded-lg">
                        <span class="time-input-label">segundos</span>
                    </div>
                </div>
                <button id="setNextPeriodButton" class="w-full bg-[#92008C] text-white p-3 rounded-lg font-semibold shadow-md hover:bg-[#7a0075] transition duration-200">Configurar Próximo Período</button>
            </div>
        </div>
    </div>

    <!-- Modal de Ajuda para o Número do Bilhete -->
    <div id="bilheteHelpModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white p-6 rounded-xl shadow-xl max-w-lg w-full relative">
            <button id="closeBilheteHelp" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-2xl font-bold" aria-label="Fechar ajuda do bilhete">&times;</button>
            <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">Onde encontrar o número do Bilhete?</h2>
            <div class="space-y-6">
                <div>
                    <h3 class="text-lg font-semibold text-gray-700 mb-2">Bilhete Único Comum:</h3>
                    <img src="https://placehold.co/400x200/cccccc/333333?text=Bilhete+Comum" alt="Exemplo de Bilhete Único Comum" class="w-full rounded-lg shadow-sm">
                    <p class="text-sm text-gray-600 mt-2 text-center">Geralmente localizado na frente, abaixo del chip ou na parte inferior.</p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-gray-700 mb-2">Bilhete Único Estudante:</h3>
                    <img src="https://placehold.co/400x200/999999/ffffff?text=Bilhete+Estudante" alt="Exemplo de Bilhete Único Estudante" class="w-full rounded-lg shadow-sm">
                    <p class="text-sm text-gray-600 mt-2 text-center">Pode estar na frente ou no verso, próximo à foto ou informações pessoais.</p>
                </div>
                <p class="text-sm text-gray-700 text-center font-medium">Observe as áreas circuladas ou destacadas em seu bilhete.</p>
            </div>
        </div>
    </div>

    <!-- Modal de Alerta para Duplicidade - MODIFICADO -->
    <div id="duplicateAlertModal" class="custom-alert-modal hidden">
        <div class="custom-alert-content">
            <button id="closeDuplicateAlert" class="custom-alert-close-btn">&times;</button>
            <div class="flex justify-center mb-4">
                <div class="triangle-icon"></div>
            </div>
            <h2 class="text-xl font-bold text-gray-800 mb-4 text-center">Número Cadastrado</h2>
            <p id="duplicateAlertMessage" class="text-lg text-gray-700 mb-6 text-center">Este número de bilhete já está cadastrado em nosso sistema.</p>
            <div class="text-center">
                <button id="okDuplicateAlert" class="bg-white text-[#92008C] px-6 py-3 rounded-lg font-semibold shadow-md border-2 border-[#92008C] hover:bg-[#92008C] hover:text-white transition duration-200">OK</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxQU3mIoqvHXY71SAHe3Cjx-cDZ82ixGOOgMvpdkGTB2sBgPUwk2Sw77ux3OQv9Ojjy4g/exec';

            // Referências aos elementos do DOM
            const formContainer = document.getElementById('formContainer');
            const registrationForm = document.getElementById('registrationForm');
            const confirmCheckbox = document.getElementById('confirmCheckbox');
            const submitButton = document.getElementById('submitButton');
            const statusMessage = document.getElementById('statusMessage');
            const cpfInput = document.getElementById('cpf');
            const numeroBilheteInput = document.getElementById('numeroBilhete');
            const helpBilheteBtn = document.getElementById('helpBilheteBtn');
            const bilheteHelpModal = document.getElementById('bilheteHelpModal');
            const closeBilheteHelp = document.getElementById('closeBilheteHelp');
            const successMessageContainer = document.getElementById('successMessageContainer');
            const errorMessageContainer = document.getElementById('errorMessageContainer');
            const backToFormSuccessBtn = document.getElementById('backToFormSuccess');
            const backToFormErrorBtn = document.getElementById('backToFormError');
            const duplicateAlertModal = document.getElementById('duplicateAlertModal');
            const duplicateAlertMessage = document.getElementById('duplicateAlertMessage');
            const closeDuplicateAlertBtn = document.getElementById('closeDuplicateAlert');
            const okDuplicateAlertBtn = document.getElementById('okDuplicateAlert');
            const nomeCompletoError = document.getElementById('nomeCompletoError');
            const cpfError = document.getElementById('cpfError');
            const bilheteError = document.getElementById('bilheteError');
            const buttonText = document.getElementById('buttonText');
            const buttonSpinner = document.getElementById('buttonSpinner');
            const countdownContainer = document.getElementById('countdownContainer');
            const countdownTimer = document.getElementById('countdownTimer');
            const unavailablePage = document.getElementById('unavailablePage');
            const unavailableCountdown = document.getElementById('unavailableCountdown');
            const adminPanel = document.getElementById('adminPanel');
            
            // Novos elementos para o painel de administração
            const activeDays = document.getElementById('activeDays');
            const activeHours = document.getElementById('activeHours');
            const activeMinutes = document.getElementById('activeMinutes');
            const activeSeconds = document.getElementById('activeSeconds');
            const inactiveDays = document.getElementById('inactiveDays');
            const inactiveHours = document.getElementById('inactiveHours');
            const inactiveMinutes = document.getElementById('inactiveMinutes');
            const inactiveSeconds = document.getElementById('inactiveSeconds');
            const enableFormButton = document.getElementById('enableFormButton');
            const setNextPeriodButton = document.getElementById('setNextPeriodButton');

            // Verificar se é admin pela URL
            const urlParams = new URLSearchParams(window.location.search);
            const isAdmin = urlParams.has('admin');
            
            // Verificar disponibilidade da planilha
            checkSpreadsheetAvailability();

            // Mostrar painel de admin se for admin
            if (isAdmin) {
                adminPanel.classList.remove('hidden');
            }

            // --- Simulação de Banco de Dados de Registros Existentes ---
            const simulatedRegisteredCPFs = new Set(['111.111.111-11', '222.222.222-22']);
            const simulatedRegisteredBilhetes = new Set(['12345678901', '98765432109']);
            // -----------------------------------------------------------

            // Função para verificar disponibilidade da planilha
            function checkSpreadsheetAvailability() {
                const spreadsheetSettings = JSON.parse(localStorage.getItem('spreadsheetSettings') || '{}');
                
                if (spreadsheetSettings.enabledUntil) {
                    const now = new Date().getTime();
                    const enabledUntil = spreadsheetSettings.enabledUntil;
                    
                    if (now < enabledUntil) {
                        // Planilha está disponível
                        formContainer.classList.remove('hidden');
                        unavailablePage.classList.add('hidden');
                        countdownContainer.classList.remove('hidden');
                        startCountdown(enabledUntil, countdownTimer, function() {
                            // Callback quando o tempo expirar
                            checkSpreadsheetAvailability();
                        });
                    } else {
                        // Planilha expirou
                        formContainer.classList.add('hidden');
                        unavailablePage.classList.remove('hidden');
                        countdownContainer.classList.add('hidden');
                        
                        // Verificar se há próximo período agendado
                        if (spreadsheetSettings.nextEnableDate) {
                            startCountdown(spreadsheetSettings.nextEnableDate, unavailableCountdown, function() {
                                // Callback quando o tempo expirar
                                checkSpreadsheetAvailability();
                            });
                        } else {
                            unavailableCountdown.textContent = "00 : 00 : 00 : 00";
                        }
                    }
                } else {
                    // Planilha nunca foi habilitada
                    formContainer.classList.add('hidden');
                    unavailablePage.classList.remove('hidden');
                    countdownContainer.classList.add('hidden');
                    unavailableCountdown.textContent = "00 : 00 : 00 : 00";
                }
            }

            // Função para iniciar contagem regressiva
            function startCountdown(targetDate, element, callback) {
                // Limpar qualquer intervalo anterior
                if (element.countdownInterval) {
                    clearInterval(element.countdownInterval);
                }
                
                element.countdownInterval = setInterval(() => {
                    const now = new Date().getTime();
                    const distance = targetDate - now;
                    
                    if (distance < 0) {
                        clearInterval(element.countdownInterval);
                        element.textContent = "00 : 00 : 00 : 00";
                        if (callback) callback();
                        return;
                    }
                    
                    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                    
                    element.textContent = `${padZero(days)} : ${padZero(hours)} : ${padZero(minutes)} : ${padZero(seconds)}`;
                }, 1000);
            }

            // Função para adicionar zero à esquerda
            function padZero(num) {
                return num.toString().padStart(2, '0');
            }

            // Habilitar formulário pelo tempo configurado
            if (enableFormButton) {
                enableFormButton.addEventListener('click', function() {
                    const days = parseInt(activeDays.value) || 0;
                    const hours = parseInt(activeHours.value) || 0;
                    const minutes = parseInt(activeMinutes.value) || 0;
                    const seconds = parseInt(activeSeconds.value) || 0;
                    
                    if (days === 0 && hours === 0 && minutes === 0 && seconds === 0) {
                        alert('Por favor, informe um tempo válido.');
                        return;
                    }
                    
                    const now = new Date().getTime();
                    const totalMs = (days * 24 * 60 * 60 * 1000) + 
                                   (hours * 60 * 60 * 1000) + 
                                   (minutes * 60 * 1000) + 
                                   (seconds * 1000);
                    
                    const enabledUntil = now + totalMs;
                    
                    const spreadsheetSettings = JSON.parse(localStorage.getItem('spreadsheetSettings') || '{}');
                    spreadsheetSettings.enabledUntil = enabledUntil;
                    
                    localStorage.setItem('spreadsheetSettings', JSON.stringify(spreadsheetSettings));
                    alert(`Formulário habilitado por ${days}d ${hours}h ${minutes}m ${seconds}s.`);
                    
                    checkSpreadsheetAvailability();
                });
            }

            // Configurar próximo período
            if (setNextPeriodButton) {
                setNextPeriodButton.addEventListener('click', function() {
                    const days = parseInt(inactiveDays.value) || 0;
                    const hours = parseInt(inactiveHours.value) || 0;
                    const minutes = parseInt(inactiveMinutes.value) || 0;
                    const seconds = parseInt(inactiveSeconds.value) || 0;
                    
                    if (days === 0 && hours === 0 && minutes === 0 && seconds === 0) {
                        alert('Por favor, informe um tempo válido.');
                        return;
                    }
                    
                    const now = new Date().getTime();
                    const totalMs = (days * 24 * 60 * 60 * 1000) + 
                                   (hours * 60 * 60 * 1000) + 
                                   (minutes * 60 * 1000) + 
                                   (seconds * 1000);
                    
                    const nextEnableDate = now + totalMs;
                    
                    const spreadsheetSettings = JSON.parse(localStorage.getItem('spreadsheetSettings') || '{}');
                    spreadsheetSettings.nextEnableDate = nextEnableDate;
                    
                    localStorage.setItem('spreadsheetSettings', JSON.stringify(spreadsheetSettings));
                    alert(`Próximo período configurado para daqui a ${days}d ${hours}h ${minutes}m ${seconds}s.`);
                    
                    checkSpreadsheetAvailability();
                });
            }

            // Restante do código JavaScript (validações, formatações, etc.)
            // ... (mantido do código original)

            // Função para formatar o CPF em tempo real (000.000.000-00)
            function formatCPF(value) {
                value = value.replace(/\D/g, "");
                value = value.substring(0, 11);
                value = value.replace(/(\d{3})(\d)/, "$1.$2");
                value = value.replace(/(\d{3})(\d)/, "$1.$2");
                value = value.replace(/(\d{3})(\d{1,2})$/, "$1-$2");
                return value;
            }

            // Função para validar CPF com dígitos verificadores
            function validarCPF(cpf) {
                cpf = cpf.replace(/\D/g, '');
                
                if (cpf.length !== 11 || /^(\d)\1{10}$/.test(cpf)) {
                    return false;
                }
                
                let soma = 0;
                for (let i = 0; i < 9; i++) {
                    soma += parseInt(cpf.charAt(i)) * (10 - i);
                }
                
                let resto = 11 - (soma % 11);
                let digitoVerificador1 = resto === 10 || resto === 11 ? 0 : resto;
                
                if (digitoVerificador1 !== parseInt(cpf.charAt(9))) {
                    return false;
                }
                
                soma = 0;
                for (let i = 0; i < 10; i++) {
                    soma += parseInt(cpf.charAt(i)) * (11 - i);
                }
                
                resto = 11 - (soma % 11);
                let digitoVerificador2 = resto === 10 || resto === 11 ? 0 : resto;
                
                return digitoVerificador2 === parseInt(cpf.charAt(10));
            }

            // Função para validar nome completo (mínimo 2 palavras)
            function validarNomeCompleto(nome) {
                const partesNome = nome.trim().split(/\s+/);
                return partesNome.length >= 2;
            }

            // Função para remover formatação de CPF/Bilhete para validação
            function cleanNumber(value) {
                return value ? value.replace(/\D/g, '') : '';
            }

            // Função para exibir mensagens de status temporárias no formulário (ex: "Enviando...")
            function showStatusMessage(message, type = 'info') {
                if (!statusMessage) return;
                statusMessage.textContent = message;
                statusMessage.classList.remove('hidden', 'text-green-600', 'text-red-600');
                
                if (type === 'success') {
                    statusMessage.classList.add('text-green-600');
                } else if (type === 'error') {
                    statusMessage.classList.add('text-red-600');
                } else {
                    statusMessage.style.color = '#92008C';
                }
                statusMessage.classList.remove('hidden');
                
                if (type !== 'error') {
                    setTimeout(() => {
                        statusMessage.classList.add('hidden');
                        statusMessage.style.color = '';
                    }, 5000);
                }
            }

            // Função para mostrar erro de validação em um campo
            function showFieldError(field, errorElement, message) {
                field.classList.add('input-error');
                errorElement.textContent = message;
                errorElement.classList.remove('hidden');
            }

            // Função para limpar erro de validação de um campo
            function clearFieldError(field, errorElement) {
                field.classList.remove('input-error');
                errorElement.classList.add('hidden');
            }

            // Função para validar todos os campos do formulário
            function validateForm() {
                let isValid = true;
                const nomeCompleto = document.getElementById('nomeCompleto');
                const cpfValue = cleanNumber(cpfInput.value);
                const bilheteValue = cleanNumber(numeroBilheteInput.value);
                
                // Validar nome completo
                if (!validarNomeCompleto(nomeCompleto.value)) {
                    showFieldError(nomeCompleto, nomeCompletoError, 'Por favor, informe seu nome completo (mínimo 2 palavras)');
                    isValid = false;
                } else {
                    clearFieldError(nomeCompleto, nomeCompletoError);
                }
                
                // Validar CPF
                if (!validarCPF(cpfValue)) {
                    showFieldError(cpfInput, cpfError, 'CPF inválido. Verifique o número digitado.');
                    isValid = false;
                } else {
                    clearFieldError(cpfInput, cpfError);
                }
                
                // Validar número do bilhete
                if (bilheteValue.length !== 11) {
                    showFieldError(numeroBilheteInput, bilheteError, 'Número do bilhete deve conter 11 dígitos');
                    isValid = false;
                } else {
                    clearFieldError(numeroBilheteInput, bilheteError);
                }
                
                return isValid;
            }

            // Função para exibir o modal de alerta customizado
            function showCustomAlert(message) {
                if (duplicateAlertModal && duplicateAlertMessage) {
                    duplicateAlertMessage.textContent = message;
                    duplicateAlertModal.classList.remove('hidden');
                }
            }

            // Função para esconder o modal de alerta customizado
            function hideCustomAlert() {
                if (duplicateAlertModal) {
                    duplicateAlertModal.classList.add('hidden');
                }
            }

            // Função para alternar entre o formulário e as mensagens de feedback
            function showFeedbackScreen(type) {
                if (formContainer) formContainer.classList.add('hidden');
                if (bilheteHelpModal) bilheteHelpModal.classList.add('hidden');

                if (type === 'success') {
                    if (successMessageContainer) successMessageContainer.classList.remove('hidden');
                    if (errorMessageContainer) errorMessageContainer.classList.add('hidden');
                } else if (type === 'error') {
                    if (errorMessageContainer) errorMessageContainer.classList.remove('hidden');
                    if (successMessageContainer) successMessageContainer.classList.add('hidden');
                }
                if (statusMessage) statusMessage.classList.add('hidden');
            }

            // Função para voltar ao formulário a partir das mensagens de feedback
            function resetFormAndShow() {
                if (successMessageContainer) successMessageContainer.classList.add('hidden');
                if (errorMessageContainer) errorMessageContainer.classList.add('hidden');
                if (formContainer) formContainer.classList.remove('hidden');
                if (registrationForm) registrationForm.reset();
                if (confirmCheckbox) confirmCheckbox.checked = false;
                if (submitButton) {
                    submitButton.disabled = true;
                    submitButton.textContent = 'Enviar Cadastro';
                }
                
                // Limpar erros de validação
                clearFieldError(document.getElementById('nomeCompleto'), nomeCompletoError);
                clearFieldError(cpfInput, cpfError);
                clearFieldError(numeroBilheteInput, bilheteError);
            }

            // Adiciona evento de input para formatar o CPF enquanto o usuário digita
            if (cpfInput) {
                cpfInput.addEventListener('input', function(e) {
                    e.target.value = formatCPF(e.target.value);
                    clearFieldError(cpfInput, cpfError);
                });
            }

            // Adiciona evento de input para validar nome completo em tempo real
            const nomeCompletoInput = document.getElementById('nomeCompleto');
            if (nomeCompletoInput) {
                nomeCompletoInput.addEventListener('input', function() {
                    clearFieldError(nomeCompletoInput, nomeCompletoError);
                });
            }

            // Habilita/Desabilita o botão de envio baseado no estado do checkbox
            if (confirmCheckbox) {
                confirmCheckbox.addEventListener('change', function() {
                    submitButton.disabled = !this.checked;
                });
            }

            // Manipula o envio do formulário
            if (registrationForm) {
                registrationForm.addEventListener('submit', async function(event) {
                    event.preventDefault();

                    // Verificar se a planilha ainda está disponível
                    const spreadsheetSettings = JSON.parse(localStorage.getItem('spreadsheetSettings') || '{}');
                    if (spreadsheetSettings.enabledUntil && new Date().getTime() > spreadsheetSettings.enabledUntil) {
                        showStatusMessage('O prazo para cadastro expirou. Não é possível enviar o formulário.', 'error');
                        checkSpreadsheetAvailability();
                        return;
                    }

                    // Validação completa dos campos
                    if (!validateForm()) {
                        showStatusMessage('Por favor, corrija os erros destacados antes de enviar.', 'error');
                        return;
                    }

                    // Coleta os dados de todos os campos do formulário
                    const rawCpf = cpfInput ? cleanNumber(cpfInput.value) : '';
                    const rawNumeroBilhete = numeroBilheteInput ? cleanNumber(numeroBilheteInput.value) : '';

                    // --- Validação de Duplicidade Simulada ---
                    if (simulatedRegisteredCPFs.has(rawCpf)) {
                        showCustomAlert('CPF já cadastrado.');
                        return;
                    }
                    if (simulatedRegisteredBilhetes.has(rawNumeroBilhete)) {
                        showCustomAlert('Número de Bilhete já cadastrado.');
                        return;
                    }
                    // ------------------------------------------

                    const formData = {
                        nomeCompleto: document.getElementById('nomeCompleto')?.value,
                        cpf: cpfInput?.value,
                        numeroBilhete: numeroBilheteInput?.value,
                        curso: document.getElementById('curso')?.value,
                        turmaProfissionalizante: document.getElementById('turmaProfissionalizante')?.value,
                        turmaFormacaoHumana: document.getElementById('turmaFormacaoHumana')?.value,
                        timestamp: new Date().toISOString()
                    };

                    // Desabilita o botão e mostra status de envio
                    if (submitButton) {
                        submitButton.disabled = true;
                        if (buttonText && buttonSpinner) {
                            buttonText.textContent = 'Enviando...';
                            buttonSpinner.classList.remove('hidden');
                        }
                        submitButton.classList.add('opacity-50', 'cursor-not-allowed');
                    }
                    showStatusMessage('Estamos enviando seus dados! Um momento, por favor...', 'info');

                    const MAX_RETRIES = 5;
                    let retries = 0;
                    let submissionSuccessful = false;

                    while (retries < MAX_RETRIES && !submissionSuccessful) {
                        try {
                            // Envia os dados para o Google Apps Script Web App
                            const response = await fetch(WEB_APP_URL, {
                                method: 'POST',
                                mode: 'no-cors',
                                cache: 'no-cache',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify(formData)
                            });

                            submissionSuccessful = true;
                            showFeedbackScreen('success');
                            
                            // Em um cenário real, após o sucesso, você adicionaria o CPF/Bilhete ao banco de dados.
                            simulatedRegisteredCPFs.add(rawCpf);
                            simulatedRegisteredBilhetes.add(rawNumeroBilhete);
                        } catch (error) {
                            console.error('Erro ao enviar dados:', error);
                            retries++;
                            if (retries < MAX_RETRIES) {
                                const delay = Math.pow(2, retries) * 1000;
                                await new Promise(res => setTimeout(res, delay));
                                showStatusMessage(`Parece que algo deu errado no envio, mas estamos tentando novamente... Tentativa ${retries} de ${MAX_RETRIES}.`, 'error');
                            } else {
                                showFeedbackScreen('error');
                            }
                        }
                    }

                    if (!submissionSuccessful) {
                        if (submitButton && buttonText && buttonSpinner) {
                            buttonText.textContent = 'Enviar Cadastro';
                            buttonSpinner.classList.add('hidden');
                            submitButton.disabled = !confirmCheckbox?.checked;
                        }
                    }
                });
            }

            // Event Listeners para o Modal de Ajuda
            if (helpBilheteBtn) {
                helpBilheteBtn.addEventListener('click', function() {
                    if (bilheteHelpModal) bilheteHelpModal.classList.remove('hidden');
                });
            }

            if (closeBilheteHelp) {
                closeBilheteHelp.addEventListener('click', function() {
                    if (bilheteHelpModal) bilheteHelpModal.classList.add('hidden');
                });
            }

            if (bilheteHelpModal) {
                bilheteHelpModal.addEventListener('click', function(event) {
                    if (event.target === bilheteHelpModal) {
                        bilheteHelpModal.classList.add('hidden');
                    }
                });
            }

            // Event Listeners para o Modal de Alerta de Duplicidade
            if (closeDuplicateAlertBtn) {
                closeDuplicateAlertBtn.addEventListener('click', hideCustomAlert);
            }
            if (okDuplicateAlertBtn) {
                okDuplicateAlertBtn.addEventListener('click', hideCustomAlert);
            }
            if (duplicateAlertModal) {
                duplicateAlertModal.addEventListener('click', function(event) {
                    if (event.target === duplicateAlertModal) {
                        hideCustomAlert();
                    }
                });
            }

            // Event Listeners para os botões "Voltar ao Formulário"
            if (backToFormSuccessBtn) backToFormSuccessBtn.addEventListener('click', resetFormAndShow);
            if (backToFormErrorBtn) backToFormErrorBtn.addEventListener('click', resetFormAndShow);
        });
    </script>
</body>
</html>
